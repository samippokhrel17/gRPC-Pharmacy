"use strict";
(() => {
  const dbHelper = require("../../helper"); // Import dbHelper directly
  module.exports = async (call, callback) => {
    let connection;
    try {
      let response = { status: false, message: "Create Failed" };
      let insert = {
        firstName: call.firstName,
        lastName: call.lastName,
        contact: call.contact,
      };
      
      // Initialize connection
      connection = await dbHelper.getConnection();
      
      const [rows] = await connection.query(
        `INSERT INTO customer SET ?`,
        insert
      );
      
      if (rows.insertId > 0) {
        response.status = true;
        response.message = "Created Successfully";
      }
      
      // Return the response using the callback
      return callback(null, response);
    } catch (error) {
      // Throw error for better debugging
      console.error(error);
      return callback(error);
    } finally {
      // Always release the connection
      if (connection) dbHelper.releaseConnection(connection);
    }
  };
})();
